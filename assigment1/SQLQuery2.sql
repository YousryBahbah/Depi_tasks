
CREATE TABLE DEPARTMENT (
    DNum INT PRIMARY KEY,
    DName VARCHAR(50),
    Location VARCHAR(50),
    SSN CHAR(9) 
);

CREATE TABLE EMPLOYEE (
    SSN CHAR(9) PRIMARY KEY,
    FName VARCHAR(50),
    LName VARCHAR(50),
    Gender CHAR(1),
    BirthDate DATE,
    DNum INT,
    Super_SSN CHAR(9),
    FOREIGN KEY (DNum) REFERENCES DEPARTMENT(DNum),
    FOREIGN KEY (Super_SSN) REFERENCES EMPLOYEE(SSN)
);

ALTER TABLE DEPARTMENT 
ADD CONSTRAINT FK_ManagerSSN FOREIGN KEY (SSN) REFERENCES EMPLOYEE(SSN);

CREATE TABLE PROJECT (
    PNum INT PRIMARY KEY,
    PName VARCHAR(50),
    City VARCHAR(50),
    DNum INT,
    FOREIGN KEY (DNum) REFERENCES DEPARTMENT(DNum)
);

CREATE TABLE DEPENDENT (
    Name VARCHAR(50),
    Gender CHAR(1),
    BirthDate DATE,
    SSN CHAR(9),
    PRIMARY KEY (Name, SSN),
    FOREIGN KEY (SSN) REFERENCES EMPLOYEE(SSN)
);

CREATE TABLE EMP_PROJECT (
    SSN CHAR(9),
    PNum INT,
    Working_Hours INT,
    PRIMARY KEY (SSN, PNum),
    FOREIGN KEY (SSN) REFERENCES EMPLOYEE(SSN),
    FOREIGN KEY (PNum) REFERENCES PROJECT(PNum)
);

CREATE TABLE MANAGER_HIREDATE (
    DNum INT,
    SSN CHAR(9),
    Date DATE,
    PRIMARY KEY (DNum, SSN),
    FOREIGN KEY (DNum) REFERENCES DEPARTMENT(DNum),
    FOREIGN KEY (SSN) REFERENCES EMPLOYEE(SSN)
);

INSERT INTO EMPLOYEE (SSN, FName, LName, Gender, BirthDate, DNum, Super_SSN) VALUES 
('111111111', 'Ali', 'Hassan', 'M', '1990-01-01', NULL, NULL),
('222222222', 'Sara', 'Omar', 'F', '1992-03-15', NULL, '111111111'),
('333333333', 'John', 'Smith', 'M', '1985-07-10', NULL, '111111111'),
('444444444', 'Laila', 'Kamel', 'F', '1993-09-23', NULL, '222222222'),
('555555555', 'Hussein', 'Ali', 'M', '1988-12-12', NULL, '111111111');

INSERT INTO DEPARTMENT (DNum, DName, Location, SSN) VALUES 
(1, 'HR', 'Cairo', '111111111'),
(2, 'IT', 'Alex', '222222222'),
(3, 'Finance', 'Giza', '444444444');

UPDATE EMPLOYEE SET DNum = 1 WHERE SSN = '111111111';
UPDATE EMPLOYEE SET DNum = 2 WHERE SSN = '222222222';
UPDATE EMPLOYEE SET DNum = 1 WHERE SSN = '333333333';
UPDATE EMPLOYEE SET DNum = 3 WHERE SSN = '444444444';
UPDATE EMPLOYEE SET DNum = 2 WHERE SSN = '555555555';

INSERT INTO PROJECT (PNum, PName, City, DNum) VALUES 
(1001, 'Payroll System', 'Cairo', 1),
(1002, 'E-Commerce Website', 'Alex', 2),
(1003, 'Finance Tracker', 'Giza', 3);

INSERT INTO EMP_PROJECT (SSN, PNum, Working_Hours) VALUES
('111111111', 1001, 20),
('222222222', 1002, 30),
('333333333', 1001, 25),
('444444444', 1003, 35),
('555555555', 1002, 15);

INSERT INTO DEPENDENT (Name, Gender, BirthDate, SSN) VALUES
('Mona', 'F', '2010-05-12', '111111111'),
('Yousef', 'M', '2008-08-08', '222222222');

INSERT INTO MANAGER_HIREDATE (DNum, SSN, Date) VALUES
(1, '111111111', '2015-01-10'),
(2, '222222222', '2016-03-01'),
(3, '444444444', '2018-06-12');

UPDATE EMPLOYEE 
SET DNum = 3 
WHERE SSN = '555555555';

DELETE FROM DEPENDENT 
WHERE Name = 'Mona' AND SSN = '111111111';

SELECT * 
FROM EMPLOYEE 
WHERE DNum = (
    SELECT DNum FROM DEPARTMENT WHERE DName = 'IT'
);

SELECT 
    E.FName, 
    E.LName, 
    P.PName, 
    EP.Working_Hours
FROM EMPLOYEE E
JOIN EMP_PROJECT EP ON E.SSN = EP.SSN
JOIN PROJECT P ON EP.PNum = P.PNum;